<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Stock Sentiment Results</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>
<div class="container">

    <h1>Sentiment Results</h1>

    <p class="subtitle">
        Showing recent news sentiment for <strong>{{ stock_name }}</strong> ({{ ticker }})
    </p>

    <!-- SUMMARY BOXES -->
    <div class="summary-row">

        <!-- PRICE TREND (LEFT) -->
        <div class="summary-box">
            <div class="summary-label">Price Trend (3 months)</div>
            <div class="summary-value">
                {{ trend_label }} ({{ "%.2f"|format(pct_change) }}%)
            </div>
        </div>

        <!-- OVERALL SENTIMENT (RIGHT) -->
        <div class="summary-box">
            <div class="summary-label">Overall Sentiment</div>
            <div class="summary-value">
                {{ overall_label }} ({{ "%.3f"|format(overall_score) }})
            </div>
        </div>

    </div>

    <hr>

    {% if articles %}
        {% for a in articles %}
        <div class="article-card">

            <h2 class="article-title">{{ a.title }}</h2>

            <p><a href="{{ a.url }}" target="_blank">Open article</a></p>

            <p class="overall-line">
                <strong>Sentiment:</strong>
                {{ a.combined_label }} ({{ "%.3f"|format(a.combined_score) }})

                <button class="details-btn" onclick="toggleDetails(this)">
                    More details ▼
                </button>
            </p>

            <div class="details-box" style="display: none;">

                <div class="model-row">

                    <div class="model-box">
                        <div class="model-title">HuggingFace</div>
                        <div class="model-value">
                            {{ a.hf.label }} ({{ "%.3f"|format(a.hf.numeric) }})
                        </div>
                    </div>

                    <div class="model-box">
                        <div class="model-title">OpenAI</div>
                        <div class="model-value">
                            {{ a.openai_sentiment }} ({{ "%.3f"|format(a.openai_num) }})
                        </div>
                    </div>

                    <div class="model-box">
                        <div class="model-title">NLTK VADER</div>
                        <div class="model-value">
                            {{ a.nltk_vader.label }} ({{ "%.3f"|format(a.nltk_vader.numeric) }})
                        </div>
                    </div>

                </div>
            </div>

            <hr>
        </div>
        {% endfor %}
    {% else %}
        <p>No articles found.</p>
    {% endif %}

    <!-- SEARCH ANOTHER STOCK BUTTON -->
    <div class="back-btn-wrapper">
        <a href="/" class="btn btn-primary back-btn">Search another stock</a>
    </div>


</div>

<script>
function toggleDetails(btn) {
    const box = btn.parentElement.nextElementSibling;

    if (box.style.display === "none") {
        box.style.display = "block";
        btn.textContent = "Hide details ▲";
    } else {
        box.style.display = "none";
        btn.textContent = "More details ▼";
    }
}
</script>

</body>
</html>
