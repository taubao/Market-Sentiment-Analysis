<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Stock Sentiment Results</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>
<div class="container">

    <h1>Sentiment Results</h1>

    <p class="subtitle">
        Showing recent news sentiment for <strong>{{ stock_name }}</strong> ({{ ticker }})
    </p>

    <!-- SUMMARY BOXES -->
    <div class="summary-row">

        <!-- PRICE TREND (LEFT) -->
        {% if pct_change > 0 %}
            {% set trend_class = 'positive' %}
        {% elif pct_change < 0 %}
            {% set trend_class = 'negative' %}
        {% else %}
            {% set trend_class = 'neutral' %}
        {% endif %}
        <div class="summary-box">
            <div class="summary-label">Price Trend (3 months)</div>
            <div class="summary-value">
                {{ trend_label }} (<span class="{{ trend_class }}">{{ "%.2f"|format(pct_change) }}%</span>)
            </div>
            <div class="explain-text">Shows percent change between the first and last closing prices over the past 3 months.</div>
        </div>

        <!-- OVERALL SENTIMENT (RIGHT) -->
        {% if overall_label|lower == 'positive' %}
            {% set overall_class = 'positive' %}
        {% elif overall_label|lower == 'negative' %}
            {% set overall_class = 'negative' %}
        {% else %}
            {% set overall_class = 'neutral' %}
        {% endif %}
        <div class="summary-box">
            <div class="summary-label">Overall Sentiment</div>
            <div class="summary-value">
                {{ overall_label }} (<span class="{{ overall_class }}">{{ "%.3f"|format(overall_score) }}</span>)
            </div>
            <div class="explain-text">The average of HuggingFace, OpenAI, and NLTK VADER numeric scores across all articles. Score ranges from -1 (very negative) to 1 (very positive).</div>
        </div>

    </div>

    <hr>

    {% if articles %}
        {% for a in articles %}
        <div class="article-card">

            <h2 class="article-title">{{ a.title }}</h2>

            <p><a href="{{ a.url }}" target="_blank">Open article</a></p>

            <p class="overall-line">
                <strong>Sentiment:</strong>
                {% if a.combined_label|lower == 'positive' %}
                    {% set comb_class = 'positive' %}
                {% elif a.combined_label|lower == 'negative' %}
                    {% set comb_class = 'negative' %}
                {% else %}
                    {% set comb_class = 'neutral' %}
                {% endif %}
                {{ a.combined_label }} (<span class="{{ comb_class }}">{{ "%.3f"|format(a.combined_score) }}</span>)

                <button class="details-btn" onclick="toggleDetails(this)">
                    More details ▼
                </button>
            </p>

            <div class="details-box" style="display: none;">

                <div class="model-row">

                    <div class="model-box">
                        <div class="model-title">HuggingFace</div>
                        <div class="model-value">
                            {% if a.hf.label|lower == 'positive' %}
                                {% set hf_class = 'positive' %}
                            {% elif a.hf.label|lower == 'negative' %}
                                {% set hf_class = 'negative' %}
                            {% else %}
                                {% set hf_class = 'neutral' %}
                            {% endif %}
                            {{ a.hf.label }} (<span class="{{ hf_class }}">{{ "%.3f"|format(a.hf.numeric) }}</span>)
                        </div>
                    </div>

                    <div class="model-box">
                        <div class="model-title">OpenAI</div>
                        <div class="model-value">
                            {% if a.openai_sentiment|lower == 'positive' %}
                                {% set ai_class = 'positive' %}
                            {% elif a.openai_sentiment|lower == 'negative' %}
                                {% set ai_class = 'negative' %}
                            {% else %}
                                {% set ai_class = 'neutral' %}
                            {% endif %}
                            {{ a.openai_sentiment }} (<span class="{{ ai_class }}">{{ "%.3f"|format(a.openai_num) }}</span>)
                        </div>
                    </div>

                    <div class="model-box">
                        <div class="model-title">NLTK VADER</div>
                        <div class="model-value">
                            {% if a.nltk_vader.label|lower == 'positive' %}
                                {% set nv_class = 'positive' %}
                            {% elif a.nltk_vader.label|lower == 'negative' %}
                                {% set nv_class = 'negative' %}
                            {% else %}
                                {% set nv_class = 'neutral' %}
                            {% endif %}
                            {{ a.nltk_vader.label }} (<span class="{{ nv_class }}">{{ "%.3f"|format(a.nltk_vader.numeric) }}</span>)
                        </div>
                    </div>

                </div>
            </div>

            <hr>
        </div>
        {% endfor %}
    {% else %}
        <p>No articles found.</p>
    {% endif %}

    <!-- SEARCH ANOTHER STOCK BUTTON -->
    <div class="back-btn-wrapper">
        <a href="/" class="btn btn-primary back-btn">Search another stock</a>
    </div>


</div>

<script>
function toggleDetails(btn) {
    const box = btn.parentElement.nextElementSibling;

    if (box.style.display === "none") {
        box.style.display = "block";
        btn.textContent = "Hide details ▲";
    } else {
        box.style.display = "none";
        btn.textContent = "More details ▼";
    }
}
</script>

</body>
</html>
